var rr=Object.defineProperty;var B=(e,r)=>{for(var n in r)rr(e,n,{get:r[n],enumerable:!0})};var le=Symbol("Comlink.proxy"),nr=Symbol("Comlink.endpoint"),ne=Symbol("Comlink.releaseProxy"),ee=Symbol("Comlink.thrown"),fe=e=>typeof e=="object"&&e!==null||typeof e=="function",tr={canHandle:e=>fe(e)&&e[le],serialize(e){let{port1:r,port2:n}=new MessageChannel;return he(e,r),[n,[n]]},deserialize(e){return e.start(),te(e)}},ar={canHandle:e=>fe(e)&&ee in e,serialize({value:e}){let r;return e instanceof Error?r={isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:r={isError:!1,value:e},[r,[]]},deserialize(e){throw e.isError?Object.assign(new Error(e.value.message),e.value):e.value}},pe=new Map([["proxy",tr],["throw",ar]]);function he(e,r=self){r.addEventListener("message",function n(t){if(!t||!t.data)return;let{id:a,type:i,path:s}=Object.assign({path:[]},t.data),c=(t.data.argumentList||[]).map(F),o;try{let d=s.slice(0,-1).reduce((f,p)=>f[p],e),l=s.reduce((f,p)=>f[p],e);switch(i){case"GET":o=l;break;case"SET":d[s.slice(-1)[0]]=F(t.data.value),o=!0;break;case"APPLY":o=l.apply(d,c);break;case"CONSTRUCT":{let f=new l(...c);o=or(f)}break;case"ENDPOINT":{let{port1:f,port2:p}=new MessageChannel;he(e,p),o=cr(f,[f])}break;case"RELEASE":o=void 0;break;default:return}}catch(d){o={value:d,[ee]:0}}Promise.resolve(o).catch(d=>({value:d,[ee]:0})).then(d=>{let[l,f]=ae(d);r.postMessage(Object.assign(Object.assign({},l),{id:a}),f),i==="RELEASE"&&(r.removeEventListener("message",n),xe(r))})}),r.start&&r.start()}function ir(e){return e.constructor.name==="MessagePort"}function xe(e){ir(e)&&e.close()}function te(e,r){return re(e,[],r)}function G(e){if(e)throw new Error("Proxy has been released and is not useable")}function re(e,r=[],n=function(){}){let t=!1,a=new Proxy(n,{get(i,s){if(G(t),s===ne)return()=>Y(e,{type:"RELEASE",path:r.map(c=>c.toString())}).then(()=>{xe(e),t=!0});if(s==="then"){if(r.length===0)return{then:()=>a};let c=Y(e,{type:"GET",path:r.map(o=>o.toString())}).then(F);return c.then.bind(c)}return re(e,[...r,s])},set(i,s,c){G(t);let[o,d]=ae(c);return Y(e,{type:"SET",path:[...r,s].map(l=>l.toString()),value:o},d).then(F)},apply(i,s,c){G(t);let o=r[r.length-1];if(o===nr)return Y(e,{type:"ENDPOINT"}).then(F);if(o==="bind")return re(e,r.slice(0,-1));let[d,l]=de(c);return Y(e,{type:"APPLY",path:r.map(f=>f.toString()),argumentList:d},l).then(F)},construct(i,s){G(t);let[c,o]=de(s);return Y(e,{type:"CONSTRUCT",path:r.map(d=>d.toString()),argumentList:c},o).then(F)}});return a}function sr(e){return Array.prototype.concat.apply([],e)}function de(e){let r=e.map(ae);return[r.map(n=>n[0]),sr(r.map(n=>n[1]))]}var ve=new WeakMap;function cr(e,r){return ve.set(e,r),e}function or(e){return Object.assign(e,{[le]:!0})}function ae(e){for(let[r,n]of pe)if(n.canHandle(e)){let[t,a]=n.serialize(e);return[{type:"HANDLER",name:r,value:t},a]}return[{type:"RAW",value:e},ve.get(e)||[]]}function F(e){switch(e.type){case"HANDLER":return pe.get(e.name).deserialize(e.value);case"RAW":return e.value}}function Y(e,r,n){return new Promise(t=>{let a=dr();e.addEventListener("message",function i(s){!s.data||!s.data.id||s.data.id!==a||(e.removeEventListener("message",i),t(s.data))}),e.start&&e.start(),e.postMessage(Object.assign({id:a},r),n)})}function dr(){return new Array(4).fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-")}var A={};B(A,{ARRAY_TYPE:()=>E,EPSILON:()=>S,RANDOM:()=>N,equals:()=>xr,setMatrixArrayType:()=>fr,toRadian:()=>hr});var S=1e-6,E=typeof Float32Array<"u"?Float32Array:Array,N=Math.random;function fr(e){E=e}var pr=Math.PI/180;function hr(e){return e*pr}function xr(e,r){return Math.abs(e-r)<=S*Math.max(1,Math.abs(e),Math.abs(r))}Math.hypot||(Math.hypot=function(){for(var e=0,r=arguments.length;r--;)e+=arguments[r]*arguments[r];return Math.sqrt(e)});var C={};B(C,{add:()=>$r,adjoint:()=>Pr,clone:()=>mr,copy:()=>Mr,create:()=>vr,determinant:()=>Ir,equals:()=>nn,exactEquals:()=>rn,frob:()=>Qr,fromQuat:()=>Yr,fromQuat2:()=>Cr,fromRotation:()=>jr,fromRotationTranslation:()=>ye,fromRotationTranslationScale:()=>Fr,fromRotationTranslationScaleOrigin:()=>_r,fromScaling:()=>Vr,fromTranslation:()=>kr,fromValues:()=>yr,fromXRotation:()=>Tr,fromYRotation:()=>zr,fromZRotation:()=>Ar,frustum:()=>Kr,getRotation:()=>Nr,getScaling:()=>ge,getTranslation:()=>Lr,identity:()=>me,invert:()=>ur,lookAt:()=>Xr,mul:()=>tn,multiply:()=>Me,multiplyScalar:()=>Jr,multiplyScalarAndAdd:()=>en,ortho:()=>Wr,orthoNO:()=>ue,orthoZO:()=>Hr,perspective:()=>qr,perspectiveFromFieldOfView:()=>Br,perspectiveNO:()=>we,perspectiveZO:()=>Ur,rotate:()=>Er,rotateX:()=>Rr,rotateY:()=>Or,rotateZ:()=>Dr,scale:()=>br,set:()=>gr,str:()=>Gr,sub:()=>an,subtract:()=>Pe,targetTo:()=>Zr,translate:()=>Sr,transpose:()=>wr});function vr(){var e=new E(16);return E!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function mr(e){var r=new E(16);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11],r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r}function Mr(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function yr(e,r,n,t,a,i,s,c,o,d,l,f,p,h,M,m){var x=new E(16);return x[0]=e,x[1]=r,x[2]=n,x[3]=t,x[4]=a,x[5]=i,x[6]=s,x[7]=c,x[8]=o,x[9]=d,x[10]=l,x[11]=f,x[12]=p,x[13]=h,x[14]=M,x[15]=m,x}function gr(e,r,n,t,a,i,s,c,o,d,l,f,p,h,M,m,x){return e[0]=r,e[1]=n,e[2]=t,e[3]=a,e[4]=i,e[5]=s,e[6]=c,e[7]=o,e[8]=d,e[9]=l,e[10]=f,e[11]=p,e[12]=h,e[13]=M,e[14]=m,e[15]=x,e}function me(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function wr(e,r){if(e===r){var n=r[1],t=r[2],a=r[3],i=r[6],s=r[7],c=r[11];e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=n,e[6]=r[9],e[7]=r[13],e[8]=t,e[9]=i,e[11]=r[14],e[12]=a,e[13]=s,e[14]=c}else e[0]=r[0],e[1]=r[4],e[2]=r[8],e[3]=r[12],e[4]=r[1],e[5]=r[5],e[6]=r[9],e[7]=r[13],e[8]=r[2],e[9]=r[6],e[10]=r[10],e[11]=r[14],e[12]=r[3],e[13]=r[7],e[14]=r[11],e[15]=r[15];return e}function ur(e,r){var n=r[0],t=r[1],a=r[2],i=r[3],s=r[4],c=r[5],o=r[6],d=r[7],l=r[8],f=r[9],p=r[10],h=r[11],M=r[12],m=r[13],x=r[14],y=r[15],g=n*c-t*s,I=n*o-a*s,P=n*d-i*s,w=t*o-a*c,u=t*d-i*c,V=a*d-i*o,O=l*m-f*M,D=l*x-p*M,k=l*y-h*M,j=f*x-p*m,T=f*y-h*m,z=p*y-h*x,b=g*z-I*T+P*j+w*k-u*D+V*O;return b?(b=1/b,e[0]=(c*z-o*T+d*j)*b,e[1]=(a*T-t*z-i*j)*b,e[2]=(m*V-x*u+y*w)*b,e[3]=(p*u-f*V-h*w)*b,e[4]=(o*k-s*z-d*D)*b,e[5]=(n*z-a*k+i*D)*b,e[6]=(x*P-M*V-y*I)*b,e[7]=(l*V-p*P+h*I)*b,e[8]=(s*T-c*k+d*O)*b,e[9]=(t*k-n*T-i*O)*b,e[10]=(M*u-m*P+y*g)*b,e[11]=(f*P-l*u-h*g)*b,e[12]=(c*D-s*j-o*O)*b,e[13]=(n*j-t*D+a*O)*b,e[14]=(m*I-M*w-x*g)*b,e[15]=(l*w-f*I+p*g)*b,e):null}function Pr(e,r){var n=r[0],t=r[1],a=r[2],i=r[3],s=r[4],c=r[5],o=r[6],d=r[7],l=r[8],f=r[9],p=r[10],h=r[11],M=r[12],m=r[13],x=r[14],y=r[15];return e[0]=c*(p*y-h*x)-f*(o*y-d*x)+m*(o*h-d*p),e[1]=-(t*(p*y-h*x)-f*(a*y-i*x)+m*(a*h-i*p)),e[2]=t*(o*y-d*x)-c*(a*y-i*x)+m*(a*d-i*o),e[3]=-(t*(o*h-d*p)-c*(a*h-i*p)+f*(a*d-i*o)),e[4]=-(s*(p*y-h*x)-l*(o*y-d*x)+M*(o*h-d*p)),e[5]=n*(p*y-h*x)-l*(a*y-i*x)+M*(a*h-i*p),e[6]=-(n*(o*y-d*x)-s*(a*y-i*x)+M*(a*d-i*o)),e[7]=n*(o*h-d*p)-s*(a*h-i*p)+l*(a*d-i*o),e[8]=s*(f*y-h*m)-l*(c*y-d*m)+M*(c*h-d*f),e[9]=-(n*(f*y-h*m)-l*(t*y-i*m)+M*(t*h-i*f)),e[10]=n*(c*y-d*m)-s*(t*y-i*m)+M*(t*d-i*c),e[11]=-(n*(c*h-d*f)-s*(t*h-i*f)+l*(t*d-i*c)),e[12]=-(s*(f*x-p*m)-l*(c*x-o*m)+M*(c*p-o*f)),e[13]=n*(f*x-p*m)-l*(t*x-a*m)+M*(t*p-a*f),e[14]=-(n*(c*x-o*m)-s*(t*x-a*m)+M*(t*o-a*c)),e[15]=n*(c*p-o*f)-s*(t*p-a*f)+l*(t*o-a*c),e}function Ir(e){var r=e[0],n=e[1],t=e[2],a=e[3],i=e[4],s=e[5],c=e[6],o=e[7],d=e[8],l=e[9],f=e[10],p=e[11],h=e[12],M=e[13],m=e[14],x=e[15],y=r*s-n*i,g=r*c-t*i,I=r*o-a*i,P=n*c-t*s,w=n*o-a*s,u=t*o-a*c,V=d*M-l*h,O=d*m-f*h,D=d*x-p*h,k=l*m-f*M,j=l*x-p*M,T=f*x-p*m;return y*T-g*j+I*k+P*D-w*O+u*V}function Me(e,r,n){var t=r[0],a=r[1],i=r[2],s=r[3],c=r[4],o=r[5],d=r[6],l=r[7],f=r[8],p=r[9],h=r[10],M=r[11],m=r[12],x=r[13],y=r[14],g=r[15],I=n[0],P=n[1],w=n[2],u=n[3];return e[0]=I*t+P*c+w*f+u*m,e[1]=I*a+P*o+w*p+u*x,e[2]=I*i+P*d+w*h+u*y,e[3]=I*s+P*l+w*M+u*g,I=n[4],P=n[5],w=n[6],u=n[7],e[4]=I*t+P*c+w*f+u*m,e[5]=I*a+P*o+w*p+u*x,e[6]=I*i+P*d+w*h+u*y,e[7]=I*s+P*l+w*M+u*g,I=n[8],P=n[9],w=n[10],u=n[11],e[8]=I*t+P*c+w*f+u*m,e[9]=I*a+P*o+w*p+u*x,e[10]=I*i+P*d+w*h+u*y,e[11]=I*s+P*l+w*M+u*g,I=n[12],P=n[13],w=n[14],u=n[15],e[12]=I*t+P*c+w*f+u*m,e[13]=I*a+P*o+w*p+u*x,e[14]=I*i+P*d+w*h+u*y,e[15]=I*s+P*l+w*M+u*g,e}function Sr(e,r,n){var t=n[0],a=n[1],i=n[2],s,c,o,d,l,f,p,h,M,m,x,y;return r===e?(e[12]=r[0]*t+r[4]*a+r[8]*i+r[12],e[13]=r[1]*t+r[5]*a+r[9]*i+r[13],e[14]=r[2]*t+r[6]*a+r[10]*i+r[14],e[15]=r[3]*t+r[7]*a+r[11]*i+r[15]):(s=r[0],c=r[1],o=r[2],d=r[3],l=r[4],f=r[5],p=r[6],h=r[7],M=r[8],m=r[9],x=r[10],y=r[11],e[0]=s,e[1]=c,e[2]=o,e[3]=d,e[4]=l,e[5]=f,e[6]=p,e[7]=h,e[8]=M,e[9]=m,e[10]=x,e[11]=y,e[12]=s*t+l*a+M*i+r[12],e[13]=c*t+f*a+m*i+r[13],e[14]=o*t+p*a+x*i+r[14],e[15]=d*t+h*a+y*i+r[15]),e}function br(e,r,n){var t=n[0],a=n[1],i=n[2];return e[0]=r[0]*t,e[1]=r[1]*t,e[2]=r[2]*t,e[3]=r[3]*t,e[4]=r[4]*a,e[5]=r[5]*a,e[6]=r[6]*a,e[7]=r[7]*a,e[8]=r[8]*i,e[9]=r[9]*i,e[10]=r[10]*i,e[11]=r[11]*i,e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],e}function Er(e,r,n,t){var a=t[0],i=t[1],s=t[2],c=Math.hypot(a,i,s),o,d,l,f,p,h,M,m,x,y,g,I,P,w,u,V,O,D,k,j,T,z,b,L;return c<S?null:(c=1/c,a*=c,i*=c,s*=c,o=Math.sin(n),d=Math.cos(n),l=1-d,f=r[0],p=r[1],h=r[2],M=r[3],m=r[4],x=r[5],y=r[6],g=r[7],I=r[8],P=r[9],w=r[10],u=r[11],V=a*a*l+d,O=i*a*l+s*o,D=s*a*l-i*o,k=a*i*l-s*o,j=i*i*l+d,T=s*i*l+a*o,z=a*s*l+i*o,b=i*s*l-a*o,L=s*s*l+d,e[0]=f*V+m*O+I*D,e[1]=p*V+x*O+P*D,e[2]=h*V+y*O+w*D,e[3]=M*V+g*O+u*D,e[4]=f*k+m*j+I*T,e[5]=p*k+x*j+P*T,e[6]=h*k+y*j+w*T,e[7]=M*k+g*j+u*T,e[8]=f*z+m*b+I*L,e[9]=p*z+x*b+P*L,e[10]=h*z+y*b+w*L,e[11]=M*z+g*b+u*L,r!==e&&(e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e)}function Rr(e,r,n){var t=Math.sin(n),a=Math.cos(n),i=r[4],s=r[5],c=r[6],o=r[7],d=r[8],l=r[9],f=r[10],p=r[11];return r!==e&&(e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[4]=i*a+d*t,e[5]=s*a+l*t,e[6]=c*a+f*t,e[7]=o*a+p*t,e[8]=d*a-i*t,e[9]=l*a-s*t,e[10]=f*a-c*t,e[11]=p*a-o*t,e}function Or(e,r,n){var t=Math.sin(n),a=Math.cos(n),i=r[0],s=r[1],c=r[2],o=r[3],d=r[8],l=r[9],f=r[10],p=r[11];return r!==e&&(e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=i*a-d*t,e[1]=s*a-l*t,e[2]=c*a-f*t,e[3]=o*a-p*t,e[8]=i*t+d*a,e[9]=s*t+l*a,e[10]=c*t+f*a,e[11]=o*t+p*a,e}function Dr(e,r,n){var t=Math.sin(n),a=Math.cos(n),i=r[0],s=r[1],c=r[2],o=r[3],d=r[4],l=r[5],f=r[6],p=r[7];return r!==e&&(e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15]),e[0]=i*a+d*t,e[1]=s*a+l*t,e[2]=c*a+f*t,e[3]=o*a+p*t,e[4]=d*a-i*t,e[5]=l*a-s*t,e[6]=f*a-c*t,e[7]=p*a-o*t,e}function kr(e,r){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}function Vr(e,r){return e[0]=r[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=r[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=r[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function jr(e,r,n){var t=n[0],a=n[1],i=n[2],s=Math.hypot(t,a,i),c,o,d;return s<S?null:(s=1/s,t*=s,a*=s,i*=s,c=Math.sin(r),o=Math.cos(r),d=1-o,e[0]=t*t*d+o,e[1]=a*t*d+i*c,e[2]=i*t*d-a*c,e[3]=0,e[4]=t*a*d-i*c,e[5]=a*a*d+o,e[6]=i*a*d+t*c,e[7]=0,e[8]=t*i*d+a*c,e[9]=a*i*d-t*c,e[10]=i*i*d+o,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function Tr(e,r){var n=Math.sin(r),t=Math.cos(r);return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t,e[6]=n,e[7]=0,e[8]=0,e[9]=-n,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function zr(e,r){var n=Math.sin(r),t=Math.cos(r);return e[0]=t,e[1]=0,e[2]=-n,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=n,e[9]=0,e[10]=t,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Ar(e,r){var n=Math.sin(r),t=Math.cos(r);return e[0]=t,e[1]=n,e[2]=0,e[3]=0,e[4]=-n,e[5]=t,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function ye(e,r,n){var t=r[0],a=r[1],i=r[2],s=r[3],c=t+t,o=a+a,d=i+i,l=t*c,f=t*o,p=t*d,h=a*o,M=a*d,m=i*d,x=s*c,y=s*o,g=s*d;return e[0]=1-(h+m),e[1]=f+g,e[2]=p-y,e[3]=0,e[4]=f-g,e[5]=1-(l+m),e[6]=M+x,e[7]=0,e[8]=p+y,e[9]=M-x,e[10]=1-(l+h),e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function Cr(e,r){var n=new E(3),t=-r[0],a=-r[1],i=-r[2],s=r[3],c=r[4],o=r[5],d=r[6],l=r[7],f=t*t+a*a+i*i+s*s;return f>0?(n[0]=(c*s+l*t+o*i-d*a)*2/f,n[1]=(o*s+l*a+d*t-c*i)*2/f,n[2]=(d*s+l*i+c*a-o*t)*2/f):(n[0]=(c*s+l*t+o*i-d*a)*2,n[1]=(o*s+l*a+d*t-c*i)*2,n[2]=(d*s+l*i+c*a-o*t)*2),ye(e,r,n),e}function Lr(e,r){return e[0]=r[12],e[1]=r[13],e[2]=r[14],e}function ge(e,r){var n=r[0],t=r[1],a=r[2],i=r[4],s=r[5],c=r[6],o=r[8],d=r[9],l=r[10];return e[0]=Math.hypot(n,t,a),e[1]=Math.hypot(i,s,c),e[2]=Math.hypot(o,d,l),e}function Nr(e,r){var n=new E(3);ge(n,r);var t=1/n[0],a=1/n[1],i=1/n[2],s=r[0]*t,c=r[1]*a,o=r[2]*i,d=r[4]*t,l=r[5]*a,f=r[6]*i,p=r[8]*t,h=r[9]*a,M=r[10]*i,m=s+l+M,x=0;return m>0?(x=Math.sqrt(m+1)*2,e[3]=.25*x,e[0]=(f-h)/x,e[1]=(p-o)/x,e[2]=(c-d)/x):s>l&&s>M?(x=Math.sqrt(1+s-l-M)*2,e[3]=(f-h)/x,e[0]=.25*x,e[1]=(c+d)/x,e[2]=(p+o)/x):l>M?(x=Math.sqrt(1+l-s-M)*2,e[3]=(p-o)/x,e[0]=(c+d)/x,e[1]=.25*x,e[2]=(f+h)/x):(x=Math.sqrt(1+M-s-l)*2,e[3]=(c-d)/x,e[0]=(p+o)/x,e[1]=(f+h)/x,e[2]=.25*x),e}function Fr(e,r,n,t){var a=r[0],i=r[1],s=r[2],c=r[3],o=a+a,d=i+i,l=s+s,f=a*o,p=a*d,h=a*l,M=i*d,m=i*l,x=s*l,y=c*o,g=c*d,I=c*l,P=t[0],w=t[1],u=t[2];return e[0]=(1-(M+x))*P,e[1]=(p+I)*P,e[2]=(h-g)*P,e[3]=0,e[4]=(p-I)*w,e[5]=(1-(f+x))*w,e[6]=(m+y)*w,e[7]=0,e[8]=(h+g)*u,e[9]=(m-y)*u,e[10]=(1-(f+M))*u,e[11]=0,e[12]=n[0],e[13]=n[1],e[14]=n[2],e[15]=1,e}function _r(e,r,n,t,a){var i=r[0],s=r[1],c=r[2],o=r[3],d=i+i,l=s+s,f=c+c,p=i*d,h=i*l,M=i*f,m=s*l,x=s*f,y=c*f,g=o*d,I=o*l,P=o*f,w=t[0],u=t[1],V=t[2],O=a[0],D=a[1],k=a[2],j=(1-(m+y))*w,T=(h+P)*w,z=(M-I)*w,b=(h-P)*u,L=(1-(p+y))*u,q=(x+g)*u,U=(M+I)*V,ce=(x-g)*V,oe=(1-(p+m))*V;return e[0]=j,e[1]=T,e[2]=z,e[3]=0,e[4]=b,e[5]=L,e[6]=q,e[7]=0,e[8]=U,e[9]=ce,e[10]=oe,e[11]=0,e[12]=n[0]+O-(j*O+b*D+U*k),e[13]=n[1]+D-(T*O+L*D+ce*k),e[14]=n[2]+k-(z*O+q*D+oe*k),e[15]=1,e}function Yr(e,r){var n=r[0],t=r[1],a=r[2],i=r[3],s=n+n,c=t+t,o=a+a,d=n*s,l=t*s,f=t*c,p=a*s,h=a*c,M=a*o,m=i*s,x=i*c,y=i*o;return e[0]=1-f-M,e[1]=l+y,e[2]=p-x,e[3]=0,e[4]=l-y,e[5]=1-d-M,e[6]=h+m,e[7]=0,e[8]=p+x,e[9]=h-m,e[10]=1-d-f,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function Kr(e,r,n,t,a,i,s){var c=1/(n-r),o=1/(a-t),d=1/(i-s);return e[0]=i*2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i*2*o,e[6]=0,e[7]=0,e[8]=(n+r)*c,e[9]=(a+t)*o,e[10]=(s+i)*d,e[11]=-1,e[12]=0,e[13]=0,e[14]=s*i*2*d,e[15]=0,e}function we(e,r,n,t,a){var i=1/Math.tan(r/2),s;return e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==1/0?(s=1/(t-a),e[10]=(a+t)*s,e[14]=2*a*t*s):(e[10]=-1,e[14]=-2*t),e}var qr=we;function Ur(e,r,n,t,a){var i=1/Math.tan(r/2),s;return e[0]=i/n,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=i,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,a!=null&&a!==1/0?(s=1/(t-a),e[10]=a*s,e[14]=a*t*s):(e[10]=-1,e[14]=-t),e}function Br(e,r,n,t){var a=Math.tan(r.upDegrees*Math.PI/180),i=Math.tan(r.downDegrees*Math.PI/180),s=Math.tan(r.leftDegrees*Math.PI/180),c=Math.tan(r.rightDegrees*Math.PI/180),o=2/(s+c),d=2/(a+i);return e[0]=o,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=d,e[6]=0,e[7]=0,e[8]=-((s-c)*o*.5),e[9]=(a-i)*d*.5,e[10]=t/(n-t),e[11]=-1,e[12]=0,e[13]=0,e[14]=t*n/(n-t),e[15]=0,e}function ue(e,r,n,t,a,i,s){var c=1/(r-n),o=1/(t-a),d=1/(i-s);return e[0]=-2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*d,e[11]=0,e[12]=(r+n)*c,e[13]=(a+t)*o,e[14]=(s+i)*d,e[15]=1,e}var Wr=ue;function Hr(e,r,n,t,a,i,s){var c=1/(r-n),o=1/(t-a),d=1/(i-s);return e[0]=-2*c,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*o,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=d,e[11]=0,e[12]=(r+n)*c,e[13]=(a+t)*o,e[14]=i*d,e[15]=1,e}function Xr(e,r,n,t){var a,i,s,c,o,d,l,f,p,h,M=r[0],m=r[1],x=r[2],y=t[0],g=t[1],I=t[2],P=n[0],w=n[1],u=n[2];return Math.abs(M-P)<S&&Math.abs(m-w)<S&&Math.abs(x-u)<S?me(e):(l=M-P,f=m-w,p=x-u,h=1/Math.hypot(l,f,p),l*=h,f*=h,p*=h,a=g*p-I*f,i=I*l-y*p,s=y*f-g*l,h=Math.hypot(a,i,s),h?(h=1/h,a*=h,i*=h,s*=h):(a=0,i=0,s=0),c=f*s-p*i,o=p*a-l*s,d=l*i-f*a,h=Math.hypot(c,o,d),h?(h=1/h,c*=h,o*=h,d*=h):(c=0,o=0,d=0),e[0]=a,e[1]=c,e[2]=l,e[3]=0,e[4]=i,e[5]=o,e[6]=f,e[7]=0,e[8]=s,e[9]=d,e[10]=p,e[11]=0,e[12]=-(a*M+i*m+s*x),e[13]=-(c*M+o*m+d*x),e[14]=-(l*M+f*m+p*x),e[15]=1,e)}function Zr(e,r,n,t){var a=r[0],i=r[1],s=r[2],c=t[0],o=t[1],d=t[2],l=a-n[0],f=i-n[1],p=s-n[2],h=l*l+f*f+p*p;h>0&&(h=1/Math.sqrt(h),l*=h,f*=h,p*=h);var M=o*p-d*f,m=d*l-c*p,x=c*f-o*l;return h=M*M+m*m+x*x,h>0&&(h=1/Math.sqrt(h),M*=h,m*=h,x*=h),e[0]=M,e[1]=m,e[2]=x,e[3]=0,e[4]=f*x-p*m,e[5]=p*M-l*x,e[6]=l*m-f*M,e[7]=0,e[8]=l,e[9]=f,e[10]=p,e[11]=0,e[12]=a,e[13]=i,e[14]=s,e[15]=1,e}function Gr(e){return"mat4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+", "+e[4]+", "+e[5]+", "+e[6]+", "+e[7]+", "+e[8]+", "+e[9]+", "+e[10]+", "+e[11]+", "+e[12]+", "+e[13]+", "+e[14]+", "+e[15]+")"}function Qr(e){return Math.hypot(e[0],e[1],e[2],e[3],e[4],e[5],e[6],e[7],e[8],e[9],e[10],e[11],e[12],e[13],e[14],e[15])}function $r(e,r,n){return e[0]=r[0]+n[0],e[1]=r[1]+n[1],e[2]=r[2]+n[2],e[3]=r[3]+n[3],e[4]=r[4]+n[4],e[5]=r[5]+n[5],e[6]=r[6]+n[6],e[7]=r[7]+n[7],e[8]=r[8]+n[8],e[9]=r[9]+n[9],e[10]=r[10]+n[10],e[11]=r[11]+n[11],e[12]=r[12]+n[12],e[13]=r[13]+n[13],e[14]=r[14]+n[14],e[15]=r[15]+n[15],e}function Pe(e,r,n){return e[0]=r[0]-n[0],e[1]=r[1]-n[1],e[2]=r[2]-n[2],e[3]=r[3]-n[3],e[4]=r[4]-n[4],e[5]=r[5]-n[5],e[6]=r[6]-n[6],e[7]=r[7]-n[7],e[8]=r[8]-n[8],e[9]=r[9]-n[9],e[10]=r[10]-n[10],e[11]=r[11]-n[11],e[12]=r[12]-n[12],e[13]=r[13]-n[13],e[14]=r[14]-n[14],e[15]=r[15]-n[15],e}function Jr(e,r,n){return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e[4]=r[4]*n,e[5]=r[5]*n,e[6]=r[6]*n,e[7]=r[7]*n,e[8]=r[8]*n,e[9]=r[9]*n,e[10]=r[10]*n,e[11]=r[11]*n,e[12]=r[12]*n,e[13]=r[13]*n,e[14]=r[14]*n,e[15]=r[15]*n,e}function en(e,r,n,t){return e[0]=r[0]+n[0]*t,e[1]=r[1]+n[1]*t,e[2]=r[2]+n[2]*t,e[3]=r[3]+n[3]*t,e[4]=r[4]+n[4]*t,e[5]=r[5]+n[5]*t,e[6]=r[6]+n[6]*t,e[7]=r[7]+n[7]*t,e[8]=r[8]+n[8]*t,e[9]=r[9]+n[9]*t,e[10]=r[10]+n[10]*t,e[11]=r[11]+n[11]*t,e[12]=r[12]+n[12]*t,e[13]=r[13]+n[13]*t,e[14]=r[14]+n[14]*t,e[15]=r[15]+n[15]*t,e}function rn(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]&&e[4]===r[4]&&e[5]===r[5]&&e[6]===r[6]&&e[7]===r[7]&&e[8]===r[8]&&e[9]===r[9]&&e[10]===r[10]&&e[11]===r[11]&&e[12]===r[12]&&e[13]===r[13]&&e[14]===r[14]&&e[15]===r[15]}function nn(e,r){var n=e[0],t=e[1],a=e[2],i=e[3],s=e[4],c=e[5],o=e[6],d=e[7],l=e[8],f=e[9],p=e[10],h=e[11],M=e[12],m=e[13],x=e[14],y=e[15],g=r[0],I=r[1],P=r[2],w=r[3],u=r[4],V=r[5],O=r[6],D=r[7],k=r[8],j=r[9],T=r[10],z=r[11],b=r[12],L=r[13],q=r[14],U=r[15];return Math.abs(n-g)<=S*Math.max(1,Math.abs(n),Math.abs(g))&&Math.abs(t-I)<=S*Math.max(1,Math.abs(t),Math.abs(I))&&Math.abs(a-P)<=S*Math.max(1,Math.abs(a),Math.abs(P))&&Math.abs(i-w)<=S*Math.max(1,Math.abs(i),Math.abs(w))&&Math.abs(s-u)<=S*Math.max(1,Math.abs(s),Math.abs(u))&&Math.abs(c-V)<=S*Math.max(1,Math.abs(c),Math.abs(V))&&Math.abs(o-O)<=S*Math.max(1,Math.abs(o),Math.abs(O))&&Math.abs(d-D)<=S*Math.max(1,Math.abs(d),Math.abs(D))&&Math.abs(l-k)<=S*Math.max(1,Math.abs(l),Math.abs(k))&&Math.abs(f-j)<=S*Math.max(1,Math.abs(f),Math.abs(j))&&Math.abs(p-T)<=S*Math.max(1,Math.abs(p),Math.abs(T))&&Math.abs(h-z)<=S*Math.max(1,Math.abs(h),Math.abs(z))&&Math.abs(M-b)<=S*Math.max(1,Math.abs(M),Math.abs(b))&&Math.abs(m-L)<=S*Math.max(1,Math.abs(m),Math.abs(L))&&Math.abs(x-q)<=S*Math.max(1,Math.abs(x),Math.abs(q))&&Math.abs(y-U)<=S*Math.max(1,Math.abs(y),Math.abs(U))}var tn=Me,an=Pe;var v={};B(v,{add:()=>ln,angle:()=>jn,bezier:()=>Sn,ceil:()=>fn,clone:()=>sn,copy:()=>on,create:()=>Ie,cross:()=>un,dist:()=>_n,distance:()=>Oe,div:()=>Fn,divide:()=>Re,dot:()=>Ve,equals:()=>Cn,exactEquals:()=>An,floor:()=>pn,forEach:()=>Un,fromValues:()=>cn,hermite:()=>In,inverse:()=>gn,len:()=>Kn,length:()=>Se,lerp:()=>Pn,max:()=>xn,min:()=>hn,mul:()=>Nn,multiply:()=>Ee,negate:()=>yn,normalize:()=>wn,random:()=>bn,rotateX:()=>Dn,rotateY:()=>kn,rotateZ:()=>Vn,round:()=>vn,scale:()=>mn,scaleAndAdd:()=>Mn,set:()=>dn,sqrDist:()=>Yn,sqrLen:()=>qn,squaredDistance:()=>De,squaredLength:()=>ke,str:()=>zn,sub:()=>Ln,subtract:()=>be,transformMat3:()=>Rn,transformMat4:()=>En,transformQuat:()=>On,zero:()=>Tn});function Ie(){var e=new E(3);return E!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function sn(e){var r=new E(3);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r}function Se(e){var r=e[0],n=e[1],t=e[2];return Math.hypot(r,n,t)}function cn(e,r,n){var t=new E(3);return t[0]=e,t[1]=r,t[2]=n,t}function on(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e}function dn(e,r,n,t){return e[0]=r,e[1]=n,e[2]=t,e}function ln(e,r,n){return e[0]=r[0]+n[0],e[1]=r[1]+n[1],e[2]=r[2]+n[2],e}function be(e,r,n){return e[0]=r[0]-n[0],e[1]=r[1]-n[1],e[2]=r[2]-n[2],e}function Ee(e,r,n){return e[0]=r[0]*n[0],e[1]=r[1]*n[1],e[2]=r[2]*n[2],e}function Re(e,r,n){return e[0]=r[0]/n[0],e[1]=r[1]/n[1],e[2]=r[2]/n[2],e}function fn(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e}function pn(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e}function hn(e,r,n){return e[0]=Math.min(r[0],n[0]),e[1]=Math.min(r[1],n[1]),e[2]=Math.min(r[2],n[2]),e}function xn(e,r,n){return e[0]=Math.max(r[0],n[0]),e[1]=Math.max(r[1],n[1]),e[2]=Math.max(r[2],n[2]),e}function vn(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e}function mn(e,r,n){return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e}function Mn(e,r,n,t){return e[0]=r[0]+n[0]*t,e[1]=r[1]+n[1]*t,e[2]=r[2]+n[2]*t,e}function Oe(e,r){var n=r[0]-e[0],t=r[1]-e[1],a=r[2]-e[2];return Math.hypot(n,t,a)}function De(e,r){var n=r[0]-e[0],t=r[1]-e[1],a=r[2]-e[2];return n*n+t*t+a*a}function ke(e){var r=e[0],n=e[1],t=e[2];return r*r+n*n+t*t}function yn(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e}function gn(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e}function wn(e,r){var n=r[0],t=r[1],a=r[2],i=n*n+t*t+a*a;return i>0&&(i=1/Math.sqrt(i)),e[0]=r[0]*i,e[1]=r[1]*i,e[2]=r[2]*i,e}function Ve(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]}function un(e,r,n){var t=r[0],a=r[1],i=r[2],s=n[0],c=n[1],o=n[2];return e[0]=a*o-i*c,e[1]=i*s-t*o,e[2]=t*c-a*s,e}function Pn(e,r,n,t){var a=r[0],i=r[1],s=r[2];return e[0]=a+t*(n[0]-a),e[1]=i+t*(n[1]-i),e[2]=s+t*(n[2]-s),e}function In(e,r,n,t,a,i){var s=i*i,c=s*(2*i-3)+1,o=s*(i-2)+i,d=s*(i-1),l=s*(3-2*i);return e[0]=r[0]*c+n[0]*o+t[0]*d+a[0]*l,e[1]=r[1]*c+n[1]*o+t[1]*d+a[1]*l,e[2]=r[2]*c+n[2]*o+t[2]*d+a[2]*l,e}function Sn(e,r,n,t,a,i){var s=1-i,c=s*s,o=i*i,d=c*s,l=3*i*c,f=3*o*s,p=o*i;return e[0]=r[0]*d+n[0]*l+t[0]*f+a[0]*p,e[1]=r[1]*d+n[1]*l+t[1]*f+a[1]*p,e[2]=r[2]*d+n[2]*l+t[2]*f+a[2]*p,e}function bn(e,r){r=r||1;var n=N()*2*Math.PI,t=N()*2-1,a=Math.sqrt(1-t*t)*r;return e[0]=Math.cos(n)*a,e[1]=Math.sin(n)*a,e[2]=t*r,e}function En(e,r,n){var t=r[0],a=r[1],i=r[2],s=n[3]*t+n[7]*a+n[11]*i+n[15];return s=s||1,e[0]=(n[0]*t+n[4]*a+n[8]*i+n[12])/s,e[1]=(n[1]*t+n[5]*a+n[9]*i+n[13])/s,e[2]=(n[2]*t+n[6]*a+n[10]*i+n[14])/s,e}function Rn(e,r,n){var t=r[0],a=r[1],i=r[2];return e[0]=t*n[0]+a*n[3]+i*n[6],e[1]=t*n[1]+a*n[4]+i*n[7],e[2]=t*n[2]+a*n[5]+i*n[8],e}function On(e,r,n){var t=n[0],a=n[1],i=n[2],s=n[3],c=r[0],o=r[1],d=r[2],l=a*d-i*o,f=i*c-t*d,p=t*o-a*c,h=a*p-i*f,M=i*l-t*p,m=t*f-a*l,x=s*2;return l*=x,f*=x,p*=x,h*=2,M*=2,m*=2,e[0]=c+l+h,e[1]=o+f+M,e[2]=d+p+m,e}function Dn(e,r,n,t){var a=[],i=[];return a[0]=r[0]-n[0],a[1]=r[1]-n[1],a[2]=r[2]-n[2],i[0]=a[0],i[1]=a[1]*Math.cos(t)-a[2]*Math.sin(t),i[2]=a[1]*Math.sin(t)+a[2]*Math.cos(t),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function kn(e,r,n,t){var a=[],i=[];return a[0]=r[0]-n[0],a[1]=r[1]-n[1],a[2]=r[2]-n[2],i[0]=a[2]*Math.sin(t)+a[0]*Math.cos(t),i[1]=a[1],i[2]=a[2]*Math.cos(t)-a[0]*Math.sin(t),e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function Vn(e,r,n,t){var a=[],i=[];return a[0]=r[0]-n[0],a[1]=r[1]-n[1],a[2]=r[2]-n[2],i[0]=a[0]*Math.cos(t)-a[1]*Math.sin(t),i[1]=a[0]*Math.sin(t)+a[1]*Math.cos(t),i[2]=a[2],e[0]=i[0]+n[0],e[1]=i[1]+n[1],e[2]=i[2]+n[2],e}function jn(e,r){var n=e[0],t=e[1],a=e[2],i=r[0],s=r[1],c=r[2],o=Math.sqrt(n*n+t*t+a*a),d=Math.sqrt(i*i+s*s+c*c),l=o*d,f=l&&Ve(e,r)/l;return Math.acos(Math.min(Math.max(f,-1),1))}function Tn(e){return e[0]=0,e[1]=0,e[2]=0,e}function zn(e){return"vec3("+e[0]+", "+e[1]+", "+e[2]+")"}function An(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]}function Cn(e,r){var n=e[0],t=e[1],a=e[2],i=r[0],s=r[1],c=r[2];return Math.abs(n-i)<=S*Math.max(1,Math.abs(n),Math.abs(i))&&Math.abs(t-s)<=S*Math.max(1,Math.abs(t),Math.abs(s))&&Math.abs(a-c)<=S*Math.max(1,Math.abs(a),Math.abs(c))}var Ln=be,Nn=Ee,Fn=Re,_n=Oe,Yn=De,Kn=Se,qn=ke,Un=function(){var e=Ie();return function(r,n,t,a,i,s){var c,o;for(n||(n=3),t||(t=0),a?o=Math.min(a*n+t,r.length):o=r.length,c=t;c<o;c+=n)e[0]=r[c],e[1]=r[c+1],e[2]=r[c+2],i(e,e,s),r[c]=e[0],r[c+1]=e[1],r[c+2]=e[2];return r}}();var _={};B(_,{add:()=>Zn,ceil:()=>Gn,clone:()=>Bn,copy:()=>Hn,create:()=>je,cross:()=>ct,dist:()=>gt,distance:()=>Ce,div:()=>yt,divide:()=>Ae,dot:()=>st,equals:()=>vt,exactEquals:()=>xt,floor:()=>Qn,forEach:()=>It,fromValues:()=>Wn,inverse:()=>at,len:()=>ut,length:()=>Ne,lerp:()=>ot,max:()=>Jn,min:()=>$n,mul:()=>Mt,multiply:()=>ze,negate:()=>tt,normalize:()=>it,random:()=>dt,round:()=>et,scale:()=>rt,scaleAndAdd:()=>nt,set:()=>Xn,sqrDist:()=>wt,sqrLen:()=>Pt,squaredDistance:()=>Le,squaredLength:()=>Fe,str:()=>ht,sub:()=>mt,subtract:()=>Te,transformMat4:()=>lt,transformQuat:()=>ft,zero:()=>pt});function je(){var e=new E(4);return E!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function Bn(e){var r=new E(4);return r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r}function Wn(e,r,n,t){var a=new E(4);return a[0]=e,a[1]=r,a[2]=n,a[3]=t,a}function Hn(e,r){return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e}function Xn(e,r,n,t,a){return e[0]=r,e[1]=n,e[2]=t,e[3]=a,e}function Zn(e,r,n){return e[0]=r[0]+n[0],e[1]=r[1]+n[1],e[2]=r[2]+n[2],e[3]=r[3]+n[3],e}function Te(e,r,n){return e[0]=r[0]-n[0],e[1]=r[1]-n[1],e[2]=r[2]-n[2],e[3]=r[3]-n[3],e}function ze(e,r,n){return e[0]=r[0]*n[0],e[1]=r[1]*n[1],e[2]=r[2]*n[2],e[3]=r[3]*n[3],e}function Ae(e,r,n){return e[0]=r[0]/n[0],e[1]=r[1]/n[1],e[2]=r[2]/n[2],e[3]=r[3]/n[3],e}function Gn(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e[2]=Math.ceil(r[2]),e[3]=Math.ceil(r[3]),e}function Qn(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e[2]=Math.floor(r[2]),e[3]=Math.floor(r[3]),e}function $n(e,r,n){return e[0]=Math.min(r[0],n[0]),e[1]=Math.min(r[1],n[1]),e[2]=Math.min(r[2],n[2]),e[3]=Math.min(r[3],n[3]),e}function Jn(e,r,n){return e[0]=Math.max(r[0],n[0]),e[1]=Math.max(r[1],n[1]),e[2]=Math.max(r[2],n[2]),e[3]=Math.max(r[3],n[3]),e}function et(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e[2]=Math.round(r[2]),e[3]=Math.round(r[3]),e}function rt(e,r,n){return e[0]=r[0]*n,e[1]=r[1]*n,e[2]=r[2]*n,e[3]=r[3]*n,e}function nt(e,r,n,t){return e[0]=r[0]+n[0]*t,e[1]=r[1]+n[1]*t,e[2]=r[2]+n[2]*t,e[3]=r[3]+n[3]*t,e}function Ce(e,r){var n=r[0]-e[0],t=r[1]-e[1],a=r[2]-e[2],i=r[3]-e[3];return Math.hypot(n,t,a,i)}function Le(e,r){var n=r[0]-e[0],t=r[1]-e[1],a=r[2]-e[2],i=r[3]-e[3];return n*n+t*t+a*a+i*i}function Ne(e){var r=e[0],n=e[1],t=e[2],a=e[3];return Math.hypot(r,n,t,a)}function Fe(e){var r=e[0],n=e[1],t=e[2],a=e[3];return r*r+n*n+t*t+a*a}function tt(e,r){return e[0]=-r[0],e[1]=-r[1],e[2]=-r[2],e[3]=-r[3],e}function at(e,r){return e[0]=1/r[0],e[1]=1/r[1],e[2]=1/r[2],e[3]=1/r[3],e}function it(e,r){var n=r[0],t=r[1],a=r[2],i=r[3],s=n*n+t*t+a*a+i*i;return s>0&&(s=1/Math.sqrt(s)),e[0]=n*s,e[1]=t*s,e[2]=a*s,e[3]=i*s,e}function st(e,r){return e[0]*r[0]+e[1]*r[1]+e[2]*r[2]+e[3]*r[3]}function ct(e,r,n,t){var a=n[0]*t[1]-n[1]*t[0],i=n[0]*t[2]-n[2]*t[0],s=n[0]*t[3]-n[3]*t[0],c=n[1]*t[2]-n[2]*t[1],o=n[1]*t[3]-n[3]*t[1],d=n[2]*t[3]-n[3]*t[2],l=r[0],f=r[1],p=r[2],h=r[3];return e[0]=f*d-p*o+h*c,e[1]=-(l*d)+p*s-h*i,e[2]=l*o-f*s+h*a,e[3]=-(l*c)+f*i-p*a,e}function ot(e,r,n,t){var a=r[0],i=r[1],s=r[2],c=r[3];return e[0]=a+t*(n[0]-a),e[1]=i+t*(n[1]-i),e[2]=s+t*(n[2]-s),e[3]=c+t*(n[3]-c),e}function dt(e,r){r=r||1;var n,t,a,i,s,c;do n=N()*2-1,t=N()*2-1,s=n*n+t*t;while(s>=1);do a=N()*2-1,i=N()*2-1,c=a*a+i*i;while(c>=1);var o=Math.sqrt((1-s)/c);return e[0]=r*n,e[1]=r*t,e[2]=r*a*o,e[3]=r*i*o,e}function lt(e,r,n){var t=r[0],a=r[1],i=r[2],s=r[3];return e[0]=n[0]*t+n[4]*a+n[8]*i+n[12]*s,e[1]=n[1]*t+n[5]*a+n[9]*i+n[13]*s,e[2]=n[2]*t+n[6]*a+n[10]*i+n[14]*s,e[3]=n[3]*t+n[7]*a+n[11]*i+n[15]*s,e}function ft(e,r,n){var t=r[0],a=r[1],i=r[2],s=n[0],c=n[1],o=n[2],d=n[3],l=d*t+c*i-o*a,f=d*a+o*t-s*i,p=d*i+s*a-c*t,h=-s*t-c*a-o*i;return e[0]=l*d+h*-s+f*-o-p*-c,e[1]=f*d+h*-c+p*-s-l*-o,e[2]=p*d+h*-o+l*-c-f*-s,e[3]=r[3],e}function pt(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e}function ht(e){return"vec4("+e[0]+", "+e[1]+", "+e[2]+", "+e[3]+")"}function xt(e,r){return e[0]===r[0]&&e[1]===r[1]&&e[2]===r[2]&&e[3]===r[3]}function vt(e,r){var n=e[0],t=e[1],a=e[2],i=e[3],s=r[0],c=r[1],o=r[2],d=r[3];return Math.abs(n-s)<=S*Math.max(1,Math.abs(n),Math.abs(s))&&Math.abs(t-c)<=S*Math.max(1,Math.abs(t),Math.abs(c))&&Math.abs(a-o)<=S*Math.max(1,Math.abs(a),Math.abs(o))&&Math.abs(i-d)<=S*Math.max(1,Math.abs(i),Math.abs(d))}var mt=Te,Mt=ze,yt=Ae,gt=Ce,wt=Le,ut=Ne,Pt=Fe,It=function(){var e=je();return function(r,n,t,a,i,s){var c,o;for(n||(n=4),t||(t=0),a?o=Math.min(a*n+t,r.length):o=r.length,c=t;c<o;c+=n)e[0]=r[c],e[1]=r[c+1],e[2]=r[c+2],e[3]=r[c+3],i(e,e,s),r[c]=e[0],r[c+1]=e[1],r[c+2]=e[2],r[c+3]=e[3];return r}}();var R={};B(R,{add:()=>Ot,angle:()=>Xt,ceil:()=>Dt,clone:()=>St,copy:()=>Et,create:()=>_e,cross:()=>_t,dist:()=>ta,distance:()=>Ue,div:()=>na,divide:()=>qe,dot:()=>Ft,equals:()=>$t,exactEquals:()=>Qt,floor:()=>kt,forEach:()=>sa,fromValues:()=>bt,inverse:()=>Lt,len:()=>Jt,length:()=>We,lerp:()=>Yt,max:()=>jt,min:()=>Vt,mul:()=>ra,multiply:()=>Ke,negate:()=>Ct,normalize:()=>Nt,random:()=>Kt,rotate:()=>Ht,round:()=>Tt,scale:()=>zt,scaleAndAdd:()=>At,set:()=>Rt,sqrDist:()=>aa,sqrLen:()=>ia,squaredDistance:()=>Be,squaredLength:()=>He,str:()=>Gt,sub:()=>ea,subtract:()=>Ye,transformMat2:()=>qt,transformMat2d:()=>Ut,transformMat3:()=>Bt,transformMat4:()=>Wt,zero:()=>Zt});function _e(){var e=new E(2);return E!=Float32Array&&(e[0]=0,e[1]=0),e}function St(e){var r=new E(2);return r[0]=e[0],r[1]=e[1],r}function bt(e,r){var n=new E(2);return n[0]=e,n[1]=r,n}function Et(e,r){return e[0]=r[0],e[1]=r[1],e}function Rt(e,r,n){return e[0]=r,e[1]=n,e}function Ot(e,r,n){return e[0]=r[0]+n[0],e[1]=r[1]+n[1],e}function Ye(e,r,n){return e[0]=r[0]-n[0],e[1]=r[1]-n[1],e}function Ke(e,r,n){return e[0]=r[0]*n[0],e[1]=r[1]*n[1],e}function qe(e,r,n){return e[0]=r[0]/n[0],e[1]=r[1]/n[1],e}function Dt(e,r){return e[0]=Math.ceil(r[0]),e[1]=Math.ceil(r[1]),e}function kt(e,r){return e[0]=Math.floor(r[0]),e[1]=Math.floor(r[1]),e}function Vt(e,r,n){return e[0]=Math.min(r[0],n[0]),e[1]=Math.min(r[1],n[1]),e}function jt(e,r,n){return e[0]=Math.max(r[0],n[0]),e[1]=Math.max(r[1],n[1]),e}function Tt(e,r){return e[0]=Math.round(r[0]),e[1]=Math.round(r[1]),e}function zt(e,r,n){return e[0]=r[0]*n,e[1]=r[1]*n,e}function At(e,r,n,t){return e[0]=r[0]+n[0]*t,e[1]=r[1]+n[1]*t,e}function Ue(e,r){var n=r[0]-e[0],t=r[1]-e[1];return Math.hypot(n,t)}function Be(e,r){var n=r[0]-e[0],t=r[1]-e[1];return n*n+t*t}function We(e){var r=e[0],n=e[1];return Math.hypot(r,n)}function He(e){var r=e[0],n=e[1];return r*r+n*n}function Ct(e,r){return e[0]=-r[0],e[1]=-r[1],e}function Lt(e,r){return e[0]=1/r[0],e[1]=1/r[1],e}function Nt(e,r){var n=r[0],t=r[1],a=n*n+t*t;return a>0&&(a=1/Math.sqrt(a)),e[0]=r[0]*a,e[1]=r[1]*a,e}function Ft(e,r){return e[0]*r[0]+e[1]*r[1]}function _t(e,r,n){var t=r[0]*n[1]-r[1]*n[0];return e[0]=e[1]=0,e[2]=t,e}function Yt(e,r,n,t){var a=r[0],i=r[1];return e[0]=a+t*(n[0]-a),e[1]=i+t*(n[1]-i),e}function Kt(e,r){r=r||1;var n=N()*2*Math.PI;return e[0]=Math.cos(n)*r,e[1]=Math.sin(n)*r,e}function qt(e,r,n){var t=r[0],a=r[1];return e[0]=n[0]*t+n[2]*a,e[1]=n[1]*t+n[3]*a,e}function Ut(e,r,n){var t=r[0],a=r[1];return e[0]=n[0]*t+n[2]*a+n[4],e[1]=n[1]*t+n[3]*a+n[5],e}function Bt(e,r,n){var t=r[0],a=r[1];return e[0]=n[0]*t+n[3]*a+n[6],e[1]=n[1]*t+n[4]*a+n[7],e}function Wt(e,r,n){var t=r[0],a=r[1];return e[0]=n[0]*t+n[4]*a+n[12],e[1]=n[1]*t+n[5]*a+n[13],e}function Ht(e,r,n,t){var a=r[0]-n[0],i=r[1]-n[1],s=Math.sin(t),c=Math.cos(t);return e[0]=a*c-i*s+n[0],e[1]=a*s+i*c+n[1],e}function Xt(e,r){var n=e[0],t=e[1],a=r[0],i=r[1],s=Math.sqrt(n*n+t*t)*Math.sqrt(a*a+i*i),c=s&&(n*a+t*i)/s;return Math.acos(Math.min(Math.max(c,-1),1))}function Zt(e){return e[0]=0,e[1]=0,e}function Gt(e){return"vec2("+e[0]+", "+e[1]+")"}function Qt(e,r){return e[0]===r[0]&&e[1]===r[1]}function $t(e,r){var n=e[0],t=e[1],a=r[0],i=r[1];return Math.abs(n-a)<=S*Math.max(1,Math.abs(n),Math.abs(a))&&Math.abs(t-i)<=S*Math.max(1,Math.abs(t),Math.abs(i))}var Jt=We,ea=Ye,ra=Ke,na=qe,ta=Ue,aa=Be,ia=He,sa=function(){var e=_e();return function(r,n,t,a,i,s){var c,o;for(n||(n=2),t||(t=0),a?o=Math.min(a*n+t,r.length):o=r.length,c=t;c<o;c+=n)e[0]=r[c],e[1]=r[c+1],i(e,e,s),r[c]=e[0],r[c+1]=e[1];return r}}();var W=class extends Error{constructor(n,t){super(t);this.type=n}};A.setMatrixArrayType(Array);var H=class{constructor(r,n){this.assetUrl=r;this.measureService=n;this.workerScene=this.measureService.createMeasureTool(r.toString())}workerScene;async measurePair(r,n,t,a){if(r.drawKind=="vertex")return n.drawKind=="vertex"?this.pointToPoint(r.parameter,n.parameter):this.measureToPoint(n,r.parameter,a);if(n.drawKind=="vertex")return this.measureToPoint(r,n.parameter,t);let i=await this.workerScene,s=[{object:r,settings:t},{object:n,settings:a}];s.sort((l,f)=>l.object.drawKind.localeCompare(f.object.drawKind));let[c,o]=s;switch(`${c.object.drawKind}_${o.object.drawKind}`){case"curveSegment_curveSegment":return await i.segmentToSegmentMeasure(c.object.ObjectId,c.object.pathIndex,c.object.instanceIndex,o.object.ObjectId,o.object.pathIndex,o.object.instanceIndex);case"curveSegment_edge":return await i.segmentToEdgeMeasure(c.object.ObjectId,c.object.pathIndex,c.object.instanceIndex,o.object.ObjectId,o.object.pathIndex,o.object.instanceIndex);case"curveSegment_face":return await i.segmentToFaceMeasure(c.object.ObjectId,c.object.pathIndex,c.object.instanceIndex,o.object.ObjectId,o.object.pathIndex,o.object.instanceIndex,o.settings);case"edge_edge":return await i.edgeToEdgeMeasure(r.ObjectId,r.pathIndex,r.instanceIndex,n.ObjectId,n.pathIndex,n.instanceIndex);case"edge_face":return await i.edgeToFaceMeasure(c.object.ObjectId,c.object.pathIndex,c.object.instanceIndex,o.object.ObjectId,o.object.pathIndex,o.object.instanceIndex,o.settings);case"face_face":return await i.faceToFaceMeasure(r.ObjectId,r.pathIndex,r.instanceIndex,n.ObjectId,n.pathIndex,n.instanceIndex,c.settings,o.settings)}}async measureSingle(r,n){let t=await this.workerScene;switch(r.drawKind){case"curveSegment":return await t.getCurveValues(r.ObjectId,r.pathIndex,r.instanceIndex,"curveSegment");case"edge":return await t.getCurveValues(r.ObjectId,r.pathIndex,r.instanceIndex,"edge");case"face":return await t.getFaceValues(r.ObjectId,r.pathIndex,r.instanceIndex,n)}}async measure(r,n,t,a){return n?await this.measurePair(r,n,t,a):await this.measureSingle(r,t)}async measureToPoint(r,n,t){let a=v.copy(v.create(),n);if(r.drawKind=="vertex")return this.pointToPoint(r.parameter,a);let i=await this.workerScene;switch(r.drawKind){case"curveSegment":return await i.segmentToPointMeasure(r.ObjectId,r.pathIndex,r.instanceIndex,a);case"edge":return await i.edgeToPointMeasure(r.ObjectId,r.pathIndex,r.instanceIndex,a);case"face":return await i.faceToPointMeasure(r.ObjectId,r.pathIndex,r.instanceIndex,a,t)}}pointToPoint(r,n){let t=v.sub(v.create(),r,n);return{drawKind:"measureResult",distance:v.len(t),distanceX:Math.abs(t[0]),distanceY:Math.abs(t[1]),distanceZ:Math.abs(t[2]),measureInfoA:{point:v.copy(v.create(),r)},measureInfoB:{point:v.copy(v.create(),n)}}}async collision(r,n,t){if(r.drawKind=="face"&&n.drawKind=="face")return await(await this.workerScene).faceToFaceCollision(r.ObjectId,r.pathIndex,r.instanceIndex,n.ObjectId,n.pathIndex,n.instanceIndex,t)}async getCameraValues(r,n){return(await this.workerScene).getCameraValuesFromFace(r.ObjectId,r.pathIndex,r.instanceIndex,n)}async pickMeasureEntity(r,n,t){let a=await this.workerScene,i=v.copy(v.create(),n);return await a.pickEntity(r,i,t)}async pickMeasureEntityOnCurrentObject(r,n,t){let a=await this.workerScene,i=v.copy(v.create(),n);return await a.pickEntityOnCurrentObject(r,i,t)}async swapCylinder(r,n){if(r.drawKind=="face"){let a=await(await this.workerScene).swapCylinder(r.ObjectId,r.pathIndex,r.instanceIndex,n);if(a!=null)return{...r,pathIndex:a}}}async followParametricEntity(r,n,t){let a=await this.workerScene,i,s,c;switch(n.drawKind){case"edge":{c="edge",i=await a.getParameterBoundsForCurve(r,n.pathIndex,"edge");break}case"face":{let o=await a.getCylinderCurve(r,n.pathIndex,n.instanceIndex,t);o&&(c="cylinder",i=o[0],s={start:o[1][0],dir:v.normalize(v.create(),v.subtract(v.create(),o[1][1],o[1][0]))});break}case"curveSegment":{c="curve",i=await a.getParameterBoundsForCurve(r,n.pathIndex,"curveSegment");break}}if(i&&c){async function o(l){if(s){let p=l<0?0:l>i.end?i.end:l;return{position:v.scaleAndAdd(v.create(),s.start,s.dir,p),normal:v.negate(v.create(),s.dir)}}let f=await a.evalCurve(r,n.pathIndex,n.instanceIndex,l,n.drawKind=="edge"?"edge":"curveSegment");if(f)return{position:f[0],normal:f[1]}}let d={...n,ObjectId:r,drawKind:n.drawKind};return{type:c,ids:[r],selectedEntity:d,parameterBounds:i,getCameraValues:o}}}async followParametricObjectFromPosition(r,n,t){let a=await this.workerScene,i=v.copy(v.create(),n),s=await a.pickEntity(r,i);if(s.entity&&s.entity.drawKind!="vertex")return this.followParametricEntity(r,s.entity,t)}async followParametricObjects(r,n){let t=await this.workerScene;if(r.length==1){let i=await t.viableFollowPathEntity(r[0]);if(i!=null&&i.drawKind!="vertex")return this.followParametricEntity(r[0],i)}let a=await t.getLineStripFromCylinders(r,n);if(a.length>1){let i=0;for(let o=1;o<a.length;++o)i+=v.dist(a[o-1],a[o]);let s={start:0,end:i};async function c(o){let d=o<0?0:o>s.end?s.end:o,l=1,f=0,p=0,h=0;for(;l<a.length&&(h=v.dist(a[l-1],a[l]),f+=h,!(f>d));++l)p=f;if(l==a.length){let m=v.subtract(v.create(),a[l-2],a[l-1]);return{position:a[l-1],normal:v.normalize(m,m)}}let M=v.subtract(v.create(),a[l-1],a[l]);return{position:v.lerp(v.create(),a[l-1],a[l],(d-p)/h),normal:v.normalize(M,M)}}return{type:a.length==2?"cylinder":"cylinders",ids:r,selectedEntity:void 0,parameterBounds:s,getCameraValues:c}}}async getParametricProduct(r){return await(await this.workerScene).getProductObject(r)}async getProfileViewFromEntity(r,n){let t=await this.workerScene;switch(r.drawKind){case"curveSegment":return await t.curveSegmentProfile(r.ObjectId,r.pathIndex,r.instanceIndex);case"face":return await t.cylinderProfile(r.ObjectId,r.pathIndex,r.instanceIndex,n)}}async getProfileViewFromMultiSelect(r,n){let a=await(await this.workerScene).multiSelectProfile(r,n);if(typeof a=="string")throw new W("Profile error",a);return a}reverseProfile(r){let n=r.profilePoints[r.profilePoints.length-1][0],t=[];for(let a=r.profilePoints.length-1;a>=0;--a){let i=r.profilePoints[a];t.push(R.fromValues((i[0]-n)*-1,i[1]))}return{profilePoints:t,slopes:r.slopes.reverse(),startElevation:r.endElevation,endElevation:r.startElevation,top:r.top,bottom:r.bottom}}areaFromPolygon(r,n){if(r.length==0)return{area:void 0,polygon:[]};if(r.length!=n.length)throw new W("Area measurement","Number of normals and vertices needs to be equal");let t=!1,a=.001,i=n[0];for(let p=1;p<n.length;++p)if(1-Math.abs(v.dot(i,n[p]))>a){t=!0;break}if(t){let p=0,h=[];for(let M=0;M<r.length;M++){let m=r[M][0],x=r[M==r.length-1?0:M+1][1],y=r[M==r.length-1?0:M+1][0],g=r[M][1];p+=m*x*.5,p-=y*g*.5,h.push(v.fromValues(r[M][0],r[M][1],r[0][2]))}return{area:Math.abs(p),polygon:h}}let s=[];s.push(r[0]);let c=r[0];for(let p=1;p<r.length;++p){let h=r[p],M=v.subtract(v.create(),h,c),m=v.dot(M,i)*-1;s.push(v.scaleAndAdd(v.create(),h,i,m))}if(s.length==1)return{area:0,polygon:s};let o=v.subtract(v.create(),s[1],s[0]);v.normalize(o,o);let d=v.cross(v.create(),i,o);v.normalize(d,d);let l=[];l.push(R.fromValues(0,0));for(let p=1;p<r.length;++p){let h=s[p],M=v.subtract(v.create(),h,c);l.push(R.fromValues(v.dot(M,o),v.dot(M,d)))}let f=0;for(let p=0;p<l.length;p++){let h=l[p][0],M=l[p==r.length-1?0:p+1][1],m=l[p==r.length-1?0:p+1][0],x=l[p][1];f+=h*M*.5,f-=m*x*.5}return{area:Math.abs(f),polygon:s}}measureLineStrip(r){let n=0,t=[],a=[],i;for(let s=1;s<r.length;++s){let c=v.dist(r[s-1],r[s]);n+=c,t.push(c);let o=v.sub(v.create(),r[s],r[s-1]);if(v.normalize(o,o),i!=null){let d=v.angle(i,o);d>Math.PI&&(d=Math.PI*2-d),a.push(d)}v.negate(o,o),i=o}return{totalLength:n,linestrip:r,segmentLengts:t,angles:a}}async inspectObject(r,n){return(await this.workerScene).getManholeValues(r)}async getManholeDrawObject(r){return(await this.workerScene).getManholeDrawObject(r)}async getEntitiyDrawObjects(r,n){let t=await this.workerScene;switch(r.drawKind){case"edge":{let a=await t.getTesselatedEdge(r.ObjectId,r.pathIndex,r.instanceIndex);return{kind:"edge",parts:[{vertices3D:a,drawType:"lines"}]}}case"face":return await t.getFaceDrawObject(r.ObjectId,r.pathIndex,r.instanceIndex,n);case"vertex":return{kind:"vertex",parts:[{vertices3D:[r.parameter],drawType:"vertex"}]};case"curveSegment":{let a=await t.tesselateCurveSegment(r.ObjectId,r.pathIndex,r.instanceIndex);return{kind:"curveSegment",parts:[{vertices3D:a,drawType:"lines"}]}}}}async getRoadProfile(r){return(await this.workerScene).getRoadProfile(r)}async getCrossSlope(r){return(await this.workerScene).getRoadCrossSlope(r)}async getCrossSections(r,n){let t=await this.workerScene;return(await Promise.all(r.map(s=>t.getCrossSection(s,n)))).filter(s=>s!=null)}};async function va(e,r){return new H(r,e)}function ie(e,r){let n=R.sub(R.create(),e.end,e.start),t=R.sub(R.create(),r.end,r.start),a=n[0]*t[1]-n[1]*t[0],i=R.sub(R.create(),r.start,e.start);if(a==0)return;let s=(i[0]*t[1]-i[1]*t[0])/a,c=(i[0]*n[1]-i[1]*n[0])/a;if(0<=s&&s<=1&&0<=c&&c<=1)return{p:R.scaleAndAdd(R.create(),e.start,n,s),t:s,u:c}}var X=1e-6;function Xe(e){let r=[];if(e.measureInfoA?.point&&e.measureInfoB?.point){let n=[e.measureInfoA?.point,e.measureInfoB?.point],t=n[0][2]>n[1][2],a=t?[n[1],n[0]]:[n[0],n[1]],i=v.sub(v.create(),a[0],a[1]),s=v.len(i);r.push({name:"result",text:s.toFixed(3),drawType:"lines",vertices3D:[v.clone(n[0]),v.clone(n[1])]}),a=[a[0],v.fromValues(a[1][0],a[0][1],a[0][2]),v.fromValues(a[1][0],a[1][1],a[0][2]),a[1]],r.push({name:"x-axis",text:Math.abs(i[0]).toFixed(3),drawType:"lines",vertices3D:[v.clone(a[0]),v.clone(a[1])]}),r.push({name:"y-axis",text:Math.abs(i[1]).toFixed(3),drawType:"lines",vertices3D:[v.clone(a[1]),v.clone(a[2])]}),r.push({name:"z-axis",text:Math.abs(i[2]).toFixed(3),drawType:"lines",vertices3D:[v.clone(a[2]),v.clone(a[3])]});let c=R.len(R.fromValues(i[0],i[2])),o=v.fromValues(a[0][0],a[0][1],Math.min(a[0][2],a[3][2])),d=v.fromValues(a[3][0],a[3][1],Math.min(a[0][2],a[3][2]));r.push({name:"xy-plane",text:c.toFixed(3),drawType:"lines",vertices3D:[o,d]});let l=v.sub(v.create(),a[2],a[3]),f=v.angle(i,l)*(180/Math.PI);if(f>.1){let M=t?v.clone(n[1]):v.clone(n[0]),m=v.clone(a[2]);r.push({name:"z-angle",text:f.toFixed(1)+"\xB0",drawType:"angle",vertices3D:[v.clone(a[3]),M,m]})}let p=v.sub(v.create(),o,d),h=v.angle(i,p)*(180/Math.PI);if(h>.1){let M=t?v.clone(n[0]):v.clone(n[1]);r.push({name:"xz-angle",text:h.toFixed(1)+"\xB0",drawType:"angle",vertices3D:[v.clone(o),M,v.clone(d)]})}}if(e.angle&&(r.push({name:"cylinder-angle",text:(e.angle.radians*(180/Math.PI)).toFixed(1)+"\xB0",drawType:"angle",vertices3D:[v.clone(e.angle.angleDrawInfo[0]),v.clone(e.angle.angleDrawInfo[1]),v.clone(e.angle.angleDrawInfo[2])]}),e.angle.additionalLine&&r.push({name:"cylinder-angle-line",drawType:"lines",vertices3D:[v.clone(e.angle.additionalLine[0]),v.clone(e.angle.additionalLine[1])]})),e.normalPoints){let n=v.len(v.sub(v.create(),e.normalPoints[0],e.normalPoints[1]));r.push({name:"normal",text:n.toFixed(3),drawType:"lines",vertices3D:[v.clone(e.normalPoints[0]),v.clone(e.normalPoints[1])]})}return{parts:r,kind:"complex"}}function Ze(e,r,n,t,a,i,s){if(t.length===0)return;let c=[];if(t.length===1)c.push({drawType:"vertex",vertices3D:t});else{let d;if(s){let l=[];for(let f=1;f<t.length;++f)l.push(v.dist(t[f-1],t[f]).toFixed(3));d=[l]}c.push({drawType:a?"filled":"lines",vertices3D:t,text:d})}let o=[];if(o.push({kind:"complex",parts:c}),i){let d=a?t.length:t.length-1;for(let l=a?0:1;l<d;++l){let f=t[l],p=l===0?t.length-1:l-1,h=l===t.length-1?0:l+1,M=t[p],m=t[h],x=v.sub(v.create(),t[p],f),y=v.sub(v.create(),t[h],f),g=v.angle(x,y)*(180/Math.PI);g>.1&&c.push({text:g.toFixed(1)+"\xB0",drawType:"angle",vertices3D:[v.clone(f),v.clone(M),v.clone(m)]})}}return K(e,r,n,o),{kind:"basic",objects:o}}function Ge(e,r,n,t,a){if(t.length===0)return;let i=[];i.push({drawType:"text",vertices3D:t,text:a});let s=[];return s.push({kind:"complex",parts:i}),K(e,r,n,s),{kind:"basic",objects:s}}function Qe(e,r){if(e.kind!="basic")return;let n=[],t=v.create();if(e.objects.forEach(a=>{(a.kind=="complex"||a.kind=="curveSegment"||a.kind=="edge")&&a.parts.forEach(i=>{if(i.vertices2D&&(i.drawType=="lines"||i.drawType=="curveSegment"||i.drawType=="filled"))for(let s=1;s<i.vertices2D.length;++s){if(v.equals(i.vertices3D[s-1],t)||v.equals(i.vertices3D[s],t))continue;let c={start:i.vertices2D[s-1],end:i.vertices2D[s]},o=ie(r,c);o&&n.push({intersection:o,line:c})}})}),n.length>0){n.sort((o,d)=>o.intersection.t-d.intersection.t);let a=n[0].line,i=a.end[0]-a.start[0],s=a.end[1]-a.start[1],c=R.fromValues(-s,i);return R.normalize(c,c),{normal:c,position:n[0].intersection.p}}}function $e(e,r){if(e.length>1){let a=[],i=v.create();if(e.forEach(s=>{s.kind=="basic"&&s.objects.forEach(c=>{(c.kind=="complex"||c.kind=="curveSegment"||c.kind=="edge")&&c.parts.forEach(o=>{if(o.vertices2D&&(o.drawType=="lines"||o.drawType=="curveSegment"||o.drawType=="filled"))for(let d=1;d<o.vertices2D.length;++d){if(v.equals(o.vertices3D[d-1],i)||v.equals(o.vertices3D[d],i))continue;let l={start:o.vertices2D[d-1],end:o.vertices2D[d]},f=ie(r,l);if(f){let p=v.sub(v.create(),o.vertices3D[d],o.vertices3D[d-1]);a.push({intersection:f,point3d:v.scaleAndAdd(v.create(),o.vertices3D[d-1],p,f.u)})}}})})}),a.length>1){a.sort((f,p)=>f.intersection.t-p.intersection.t);let s=[v.create()],c=[r.start],o=[""];a.forEach(f=>{c.push(f.intersection.p)}),c.push(r.end);for(let f=0;f<a.length;++f)f!=0&&o.push(v.dist(a[f].point3d,a[f-1].point3d).toFixed(3)),s.push(a[f].point3d);s.push(v.create()),o.push("");let d=[];d.push({drawType:"lines",vertices3D:s,vertices2D:c,text:[o]});let l=[];return l.push({kind:"complex",parts:d}),{kind:"basic",objects:l}}}let n=[];n.push({drawType:"lines",vertices3D:[],vertices2D:[r.start,r.end]});let t=[];return t.push({kind:"complex",parts:n}),{kind:"basic",objects:t}}function $(e,r,n){let t=C.fromRotationTranslation(C.create(),n.rotation,n.position);if(C.invert(t,t),n.kind=="pinhole"){let a=C.perspective(C.create(),A.toRadian(n.fov),e/r,n.near,n.far);return{camMat:t,projMat:a}}else{let a=e/r,i=n.fov/2,s=i*a,c=C.ortho(C.create(),-s,s,-i,i,n.near,n.far);return{camMat:t,projMat:c}}}function Z(e,r,n,t){let a=_.transformMat4(_.create(),_.fromValues(t[0],t[1],t[2],1),e),i=R.fromValues(Math.round((a[0]*.5/a[3]+.5)*r),Math.round((.5-a[1]*.5/a[3])*n));return i.every(s=>!Number.isNaN(s)&&Number.isFinite(s))?i:R.fromValues(-100,-100)}function Q(e,r,n,t,a,i,s){let c=(h,M)=>{let m=v.sub(v.create(),M,h);return v.scale(m,m,(-t-h[2])/m[2]),v.add(m,m,h)},o=[],d=[],l=[],f=e.map(h=>v.transformMat4(v.create(),h,r));if(s)for(let h of f)h[2]>0&&h[2]<.1&&(h[2]=-1e-4);let p=f.reduce((h,M,m)=>{if(M[2]>X){if(m===0||f[m-1][2]>0)return d.push(m),h;let y=c(f[m-1],M),g=Z(n,a,i,y);return o.push(g),h.concat([g])}let x=Z(n,a,i,M);if(o.push(x),m!==0&&f[m-1][2]>X){let y=c(M,f[m-1]),g=Z(n,a,i,y);return l.push(m),h.concat([g],[x])}return h.concat([x])},[]);if(p.length)return{screenPoints:p,points2d:o,removedIndices:d,addedIndices:l}}function K(e,r,n,t){let{camMat:a,projMat:i}=$(e,r,n);for(let s of t)for(let c of s.parts){let o=Q(c.vertices3D,a,i,n.near,e,r,n.kind=="orthographic");if(o){let{screenPoints:d,removedIndices:l,addedIndices:f}=o;if(c.vertices2D=d,l.length>0||f.length>0){c.text&&Array.isArray(c.text)&&(c.text[0]=c.text[0].reduce((h,M,m)=>f.find(x=>x==m)!=null&&l.find(x=>x==m-1)==null?h.concat(["",M]):l.find(x=>x==m)!=null&&l.find(x=>x==m+1)!=null?h:h.concat(M),[]));let p=[];c.vertices3D.forEach((h,M)=>{if(f.find(m=>m==M)!=null&&l.find(m=>m==M-1)==null)p.concat([v.create(),h]);else if(l.find(m=>m==M)==null||l.find(m=>m==M+1)==null)return p.push(h);c.vertices3D=p})}}c.voids&&c.voids.forEach((d,l)=>{let f=Q(d.vertices3D,a,i,n.near,e,r,n.kind=="orthographic");if(f){let{screenPoints:p,removedIndices:h,addedIndices:M}=f;d.vertices2D=p,(h.length>0||M.length>0)&&c.text&&Array.isArray(c.text)&&(c.text[l+1]=c.text[l+1].reduce((m,x,y)=>M.find(g=>g==y)!=null&&h.find(g=>g==y-1)==null?m.concat(["",x]):h.find(g=>g==y)!=null&&h.find(g=>g==y+1)!=null?m:m.concat(x),[]))}})}}async function Je(e,r,n,t,a,i){if(a){let s=[],c;if(a.drawKind=="manhole")s=await t.getManholeDrawObject(a),c="manhole";else if(a.drawKind=="measureResult")s=[Xe(a)],c="measureResult";else{let o=await t.getEntitiyDrawObjects(a,i);o&&(s=[o]),c="basic"}return s&&K(e,r,n,s),{kind:c,objects:s}}}var ca=document.currentScript?.src??import.meta.url,J=class{scriptUrl;workers;constructor(r){let n=new URL(r??ca);this.scriptUrl=new URL("./",n).href.slice(0,-1)}createWorkers(){let n=((a,i)=>{if(this.scriptUrl.startsWith(self.location.origin))return new Worker(a,{type:"classic",name:i});{let s=new Blob([`importScripts(${JSON.stringify(a)});`],{type:"text/javascript"}),c=URL.createObjectURL(s),o=new Worker(c,{type:"classic",name:i});return URL.revokeObjectURL(c),o}})(`${this.scriptUrl}/worker.js`,"Measure"),t=te(n);this.workers={measure:{worker:n,service:t}},t.initialize(this.scriptUrl)}loadScene(r){return this.workers||this.createWorkers(),typeof r=="string"&&(r=new URL(r.toString())),new H(r,this.workers.measure.service)}async dispose(){let{workers:r}=this;if(r){let{measure:n}=r;await n.service.terminate(),n.service[ne](),this.workers=void 0}}toPathPoints(r,n,t,a){let{camMat:i,projMat:s}=$(n,t,a);return Q(r,i,s,a.near,n,t,a.kind=="orthographic")}toMarkerPoints(r,n,t,a){let{camMat:i,projMat:s}=$(r,n,t);return a.map(c=>v.transformMat4(v.create(),c,i)).map((c,o,d)=>{if(t.kind==="orthographic"&&c[2]>0&&c[2]<.1&&(c[2]=-1e-4),!(c[2]>X))return Z(s,r,n,c)})}async getDrawMeasureEntity(r,n,t,a,i,s){return Je(r,n,t,a,i,s)}updateDrawProuct(r,n,t,a){K(r,n,t,a.objects)}getDrawObjectFromPoints(r,n,t,a,i=!0,s=!0,c=!1){return Ze(r,n,t,a,i,s,c)}getDrawText(r,n,t,a,i){return Ge(r,n,t,a,i)}traceDrawObjects(r,n){return $e(r,n)}get2dNormal(r,n){return Qe(r,n)}};function se(e,r){return!e&&r||e&&!r?!1:e&&r?e.pathIndex==r.pathIndex&&e.pathKind==r.pathKind:!0}function Ka(e,r){return!e&&r||e&&!r?!1:e&&r?e.ObjectId==r.ObjectId&&e.pathIndex==r.pathIndex&&e.pathKind==r.pathKind:!0}A.setMatrixArrayType(Array);var er=class{constructor(r,n,t,a,i){this.id=r;this.getPaths=n;this.getEntitiyDrawObjects=t;this.swapCylinderInternal=a;this.selected=i}_renderOutput;facePaths=[];edgePaths=[];currentDir=v.create();viewDirMatrix=C.create();selected;highlighted;dirty=!0;get selectedEntity(){if(this.selected)return this.createMeasureEntity(this.selected)}get productId(){return this.id}async swapCylinder(r){let n=this.selectedEntity;if(n){let t=await this.swapCylinderInternal(this.createMeasureEntity(n),r);t!=null&&(this.selected.pathIndex=t)}return!1}createMeasureEntity(r){let n=r.pathKind;return{...r,ObjectId:this.id,kind:n}}contextTransform(r,n,t,a){let i=n/2,s=t/2,c=a.viewClipMatrix[5]*s;var o=(1+a.worldClipMatrix[12])*i,d=(1-a.worldClipMatrix[13])*s;let l=new DOMMatrix([c,0,0,-c,o,d]);r.setTransform(l),r.lineWidth=2/c}renderPoints(r,n,t,a){if(this._renderOutput){let i=this._renderOutput;this.contextTransform(r,n,t,i);let s=i.viewClipMatrix[5]*t/2,{viewDirMatrix:c}=this,o=5/s;r.fillStyle="red";for(let d of a){let l=v.transformMat4(v.create(),d,c),[f,p]=l;r.beginPath(),r.ellipse(f,p,o,o,0,0,2*Math.PI),r.fill()}r.resetTransform()}}renderPaths(r,n,t){let{facePaths:a,edgePaths:i}=this,{pathIndex:s,pathKind:c}=this.highlighted??{},{pathIndex:o,pathKind:d}=this.selected??{};if(this._renderOutput){this.contextTransform(r,n,t,this._renderOutput);for(let l of a){let{path:f,originalIndex:p}=l;c=="face"&&p===s?r.fillStyle="yellow":d=="face"&&p===o?r.fillStyle="green":r.fillStyle="darkgray",r.fill(f),r.strokeStyle="white",r.stroke(f)}for(let l of i){let{path:f,originalIndex:p}=l;c=="edge"&&p===s?r.strokeStyle="yellow":d=="edge"&&p===o?r.strokeStyle="green":r.strokeStyle="black",r.stroke(f)}r.resetTransform()}this.dirty=!1}hover(r,n,t,a,i){let s=this.pickPath(r,n,t,a,i);return se(this.highlighted,s)?!1:(this.highlighted=s,this.dirty=!0,!0)}select(){return se(this.highlighted,this.selected)||!this.highlighted?!1:(this.selected=this.highlighted,this.dirty=!0,!0)}pickPath(r,n,t,a,i){if(this._renderOutput){this.contextTransform(r,a,i,this._renderOutput);let{facePaths:s,edgePaths:c}=this;for(let o=c.length-1;o>=0;--o){let d=c[o],{path:l}=d;if(r.isPointInStroke(l,n,t))return{pathKind:"edge",pathIndex:d.originalIndex,instanceIndex:d.instanceIndex,parameter:0}}for(let o=s.length-1;o>=0;--o){let d=s[o],{path:l}=d;if(r.isPointInPath(l,n,t))return{pathKind:"face",pathIndex:d.originalIndex,instanceIndex:d.instanceIndex,parameter:0}}}r.resetTransform()}};var ti=["center","closest","furthest","top","bottom"];function ai(e){return new J(e)}export{K as FillDrawInfo2D,J as MeasureAPI,W as MeasureError,er as MeasureObject,H as MeasureScene,ai as createMeasureAPI,ti as cylinderOptions,Ka as equalMeasureEntity,se as equalMeasureEntityIndex,$ as getPathMatrices,va as loadScene,Je as renderMeasureEntity,Q as toPathPointsFromMatrices,Z as toScreen};
